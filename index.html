<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Thiết bị</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
<h2>Thông tin thiết bị</h2>
<div id="output">Đang tải dữ liệu...</div>

<script>
// === 1. Lấy code từ URL ===
const urlParams = new URLSearchParams(window.location.search);
const deviceCode = urlParams.get("code");

if (!deviceCode) {
    document.getElementById("output").innerHTML = "Không tìm thấy mã thiết bị.";
    throw "";
}

// === 2. Link Excel OneDrive (direct download) ===
// Share link OneDrive → đổi "redir?resid" thành "download?resid"
const EXCEL_URL = "YOUR_ONEDRIVE_DIRECT_DOWNLOAD_LINK.xlsx";

// === 3. Tải file Excel ===
fetch(EXCEL_URL)
  .then(res => res.arrayBuffer())
  .then(buffer => {
      const data = new Uint8Array(buffer);
      const workbook = XLSX.read(data, { type: "array" });

      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(sheet);

      // === 4. Tìm thiết bị theo code ===
      const item = rows.find(r => r.CODE == deviceCode);

      if (!item) {
          document.getElementById("output").innerHTML = "Không tìm thấy thiết bị: " + deviceCode;
          return;
      }

      // === 5. Hiển thị thông tin ===
      let html = `<b>Mã thiết bị:</b> ${item.CODE}<br>
                  <b>Tên:</b> ${item.NAME}<br>
                  <b>Model:</b> ${item.MODEL}<br>
                  <b>Serial:</b> ${item.SERIAL}<br>
                  <b>Ngày mua:</b> ${item.PURCHASE_DATE}<br>
                  <b>Ghi chú:</b> ${item.NOTE}`;

      document.getElementById("output").innerHTML = html;
  })
  .catch(err => {
      document.getElementById("output").innerHTML = "Lỗi tải dữ liệu";
      console.error(err);
  });
</script>

</body>
</html>
